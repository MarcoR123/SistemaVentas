<div class="container mt-5">
  <h2 class="text-center">Visualización y Descarga de Informes</h2>

  <!-- Selección de Informe -->
  <div class="mb-3">
    <label for="reportType">Selecciona el tipo de informe:</label>
    <select id="reportType" [(ngModel)]="selectedReport" class="form-select" (change)="loadReportData()">
      <option value="ventas">Informe de Ventas</option>
      <option value="vendedores">Informe de Vendedores y su Marca</option>
      <option value="soporte">Informe de Soporte al Cliente</option>
    </select>
  </div>

  <!-- Filtros -->
  <div class="row">
    <div class="col-md-4">
      <label for="startDate">Fecha Inicio:</label>
      <input type="date" [(ngModel)]="startDate" class="form-control" />
    </div>
    <div class="col-md-4">
      <label for="endDate">Fecha Fin:</label>
      <input type="date" [(ngModel)]="endDate" class="form-control" />
    </div>
    <div class="col-md-4">
      <label for="vendedor">Seleccionar Vendedor:</label>
      <select [(ngModel)]="selectedVendedor" class="form-select">
        <option *ngFor="let vendedor of vendedores">{{ vendedor }}</option>
      </select>
    </div>
    <div class="col-md-4 mt-2">
      <label for="client">Seleccionar Cliente:</label>
      <select [(ngModel)]="selectedClientName" class="form-select">
        <option *ngFor="let client of clientes">{{ client }}</option>
      </select>
    </div>
  </div>

  <button (click)="filterData()" class="btn btn-primary mt-3">Filtrar</button>

  <!-- Tabla de datos -->
  <div *ngIf="filteredData.length > 0">
    <table class="table mt-4">
      <thead class="thead-dark">
        <!-- Cabeceras de Ventas -->
        <tr *ngIf="selectedReport === 'ventas'">
          <th>Fecha de Venta</th>
          <th>Producto</th>
          <th>Cliente</th>
          <th>Vendedor</th>
          <th>Cantidad</th>
          <th>Precio Total</th>
        </tr>

        <!-- Cabeceras de Vendedores -->
        <tr *ngIf="selectedReport === 'vendedores'">
          <th>Nombre</th>
          <th>Correo Electrónico</th>
          <th>Rol</th>
          <th>Región Asignada</th>
          <th>Cliente</th>
        </tr>

        <!-- Cabeceras de Soporte al Cliente -->
        <tr *ngIf="selectedReport === 'soporte'">
          <th>Fecha</th>
          <th>Producto</th>
          <th>Cliente</th>
          <th>Usuario</th>
          <th>Comentarios</th>
          <th>Capacitación</th>
          <th>Queja</th>
        </tr>
      </thead>
      <tbody>
        <!-- Reporte de Ventas -->
        <ng-container *ngIf="selectedReport === 'ventas'">
          <tr *ngFor="let sale of filteredData">
            <td>{{ sale.date | date }}</td>
            <td>{{ sale.products?.[0]?.product_name || 'N/A' }}</td>
            <td>{{ sale.products?.[0]?.client_name || sale.clientName }}</td>
            <td>{{ sale.user_name }}</td>
            <td>{{ sale.products?.[0]?.quantity }}</td>
            <td>{{ sale.total_price | currency }}</td>
          </tr>
        </ng-container>

        <!-- Reporte de Vendedores -->
        <ng-container *ngIf="selectedReport === 'vendedores'">
          <tr *ngFor="let user of filteredData">
            <td>{{ user.name || 'Sin nombre' }}</td>
            <td>{{ user.email || 'Sin correo' }}</td>
            <td>{{ user.role || 'Sin rol' }}</td>
            <td>{{ user.assigned_region || 'Sin región' }}</td>
            <td>{{ user.clientName || 'Sin cliente' }}</td>
          </tr>
        </ng-container>

        <!-- Reporte de Soporte al Cliente -->
        <ng-container *ngIf="selectedReport === 'soporte'">
          <tr *ngFor="let support of filteredData">
            <td>{{ support.date | date }}</td>
            <td>{{ support.product_name || 'N/A' }}</td>
            <td>{{ support.client_name || 'N/A' }}</td>
            <td>{{ support.user_name || 'N/A' }}</td>
            <td>{{ support.comments || 'Sin comentarios' }}</td>
            <td>{{ support.training ? 'Sí' : 'No' }}</td>
            <td>{{ support.complaint ? 'Sí' : 'No' }}</td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>

  <div *ngIf="filteredData.length === 0" class="alert alert-warning mt-4">
    {{ noDataMessage }}
  </div>

  <!-- Botones de exportación -->
  <div class="d-flex justify-content-end gap-2">
    <button (click)="exportToExcel()" class="btn btn-success mt-3">Exportar a Excel</button>
    <button (click)="exportToPDF()" class="btn btn-danger mt-3">Exportar a PDF</button>
  </div>
</div>
